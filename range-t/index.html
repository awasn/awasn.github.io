<!DOCTYPE HTML>
<html lang="pl-pl">
    <head>
        <meta name="theme-color" content="#405365"/>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="generator" content="Hugo 0.83.1" />
        <meta name="description" content="Własna implementacja klasy do porównań Range w .NET C#" />
        <title>Range&lt;T&gt; - arkadiusz wasniewski blog</title>
        <link rel="canonical" href="https://awasn.github.io/range-t/">
        <link rel="prev" title="MarshalHelper zarządza niezarządzanym" href="https://awasn.github.io/marshalhelper-zarzadza-niezarzadzanym/">
        <link rel="next" title="Refaktoryzacja metod zwrotnych" href="https://awasn.github.io/refaktoryzacja-metod-zwrotnych/">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css" integrity="sha256-Q0zCrUs2IfXWYx0uMKJfG93CvF6oVII21waYsAV4/8Q=" crossorigin="anonymous" />
        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css" integrity="sha256-YqnnS/cQ7vE7gfVjdfx+JMi5EFD6m6Zqdemj81rs6PU=" crossorigin="anonymous" />
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/agate.min.css">
        <link rel="stylesheet" href="https://awasn.github.io/awasn.min.f45a909800924faa836a73b82a1d4cb352f8053134a426a9dcafa61cf6a8c5d0.css" integrity="sha256-9FqQmACST6qDanO4Kh1Ms1L4BTE0pCap3K&#43;mHPaoxdA=" />

    </head>
    <body>
        <header>
            <nav class="container" >
                <div class="pure-menu pure-menu-horizontal">
                    <a class="pure-menu-heading pure-menu-link" href="https://awasn.github.io/">wasniewski</a>
                    <ul class="right pure-menu-list">
                        <li class="pure-menu-item"><a class="pure-menu-link" href="https://awasn.github.io/blog/">blog</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="https://awasn.github.io/categories/">categories</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="https://awasn.github.io/tags/">tags</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="https://awasn.github.io/about/">about</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <main class="container">
            
    <aside class="post-published">
        <p>This post was originally published on <a href="http://zine.net.pl/blogs/arkadiusz_wasniewski/archive/2008/07/11/range-t.aspx" target="_blank">zine.net.pl</a> on 11 July 2008 15:30 &#43;0200</p>
    </aside>

    <article>
        <header>
            <h1>Range&lt;T&gt;</h1>
                <div class="post-metadata">
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            11 July 2008 15:30 &#43;0200
            
                &nbsp;
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path><polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon></svg>
                08 June 2018 16:58 &#43;0200
            
            &nbsp;
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            3 min read
        </div>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
            <a href="https://awasn.github.io/categories/development">Development</a>
            
                &nbsp;
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>
                <a href="https://awasn.github.io/tags/.net">.NET</a>, <a href="https://awasn.github.io/tags/design-patterns">Design patterns</a>
            
        </div>
    </div>
        </header>

        <p>Porównań i walidacji w kodzie zawsze dużo jest. Czasem, jak u mnie ostatnio, warto spreparować sobie specjalną klasę operacje tego typu ułatwiającą. Koncept nie jest nowy. Poczytać można o nim między innymi na stronie <a href="http://martinfowler.com/eaaDev/Range.html">Martina Fowlera</a>. Ciekawa natomiast jest implementacja, którą można wykonać korzystając z platformy .NET.</p>
<p>Pierwsza wersja klasy w najważniejszych swoich częściach wyglądała następująco:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Range</span>&lt;T&gt;
    {
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> T minimum;
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> T maximum;
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#66d9ef">bool</span> rangeIsExclusive;

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> Included(T <span style="color:#66d9ef">value</span>)
        {
            Debug.Assert(<span style="color:#66d9ef">value</span> != <span style="color:#66d9ef">null</span>);

            <span style="color:#66d9ef">if</span>(minimum &gt; <span style="color:#66d9ef">value</span>){
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }
            <span style="color:#66d9ef">if</span>(minimum == <span style="color:#66d9ef">value</span> &amp;&amp; rangeIsExclusive){
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }
            <span style="color:#66d9ef">if</span> (maximum &lt; <span style="color:#66d9ef">value</span>) {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }
            <span style="color:#66d9ef">if</span> (maximum == <span style="color:#66d9ef">value</span> &amp;&amp; rangeIsExclusive) {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }

            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
        }
    }
</code></pre></div><p>Nie było to najszczęśliwsze rozwiązanie. Skąd kompilator ma wiedzieć jak są dla potencjalnego typu zakresu zdefiniowane operacje porównania? Dla liczb całkowitych czy rzeczywistych jest to oczywiste. Ale dla obiektów zawierających np. imię i nazwisko pracownika już nie.</p>
<p>Jak zatem podejść do tematu? Rozwiązania należy szukać wśród interfejsów. Nakładamy na typ zakresu naszej klasy więzy, iż musi on implementować interfejs <code>IComparable&lt;T&gt;</code> umożliwiający porównywanie klas i struktur. Pełny kod źródłowy poniżej.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">    <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// Klasa opisująca dowolny zakres.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/// &lt;typeparam name=&#34;T&#34;&gt;Typ wybranego zakresu.&lt;/typeparam&gt;
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Range</span>&lt;T&gt; <span style="color:#66d9ef">where</span> T : IComparable&lt;T&gt;
    {
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> T minimum;
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> T maximum;
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> <span style="color:#66d9ef">bool</span> rangeIsExclusive;

        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// Konstruktor.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;minimum&#34;&gt;Dozwolona wartość minimalna.&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;maximum&#34;&gt;Dozwolona wartość maksymalna.&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;remarks&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// Domyślnie badana wartość może być równa wartości minimalnej
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// lub maksymalnej.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/remarks&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> Range(T minimum, T maximum)
            : <span style="color:#66d9ef">this</span>(minimum, maximum, <span style="color:#66d9ef">false</span>)
        {
        }

        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// Konstruktor.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;minimum&#34;&gt;Dozwolona wartość minimalna.&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;maximum&#34;&gt;Dozwolona wartość maksymalna.&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;rangeIsExclusive&#34;&gt;Czy badana wartość musi być
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// różna od wartości minimalnej i maksymalnej (nierówność
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// ostra).&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> Range(T minimum, T maximum, <span style="color:#66d9ef">bool</span> rangeIsExclusive)
        {
            Debug.Assert(minimum != <span style="color:#66d9ef">null</span>);
            Debug.Assert(maximum != <span style="color:#66d9ef">null</span>);
            Debug.Assert(minimum.CompareTo(maximum) &lt;= <span style="color:#ae81ff">0</span>);

            <span style="color:#66d9ef">this</span>.minimum = minimum;
            <span style="color:#66d9ef">this</span>.maximum = maximum;
            <span style="color:#66d9ef">this</span>.rangeIsExclusive = rangeIsExclusive;
        }

        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// Dozwolona wartość minimalna.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> T Mimimum
        {
            <span style="color:#66d9ef">get</span> { <span style="color:#66d9ef">return</span> minimum; }
        }

        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// Dozwolona wartość maksymalna.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> T Maximum
        {
            <span style="color:#66d9ef">get</span> { <span style="color:#66d9ef">return</span> maximum; }
        }

        <span style="color:#75715e">/// &lt;summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// Czy podawana parametrem wartość mieści się w zadanym zakresie.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;/summary&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;param name=&#34;value&#34;&gt;Wartość, którą chcemy sprawdzić.&lt;/param&gt;
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// &lt;returns&gt;Metoda zwraca &lt;b&gt;true&lt;/b&gt; jeśli podana wartość mieści
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/// się w zakresie.&lt;/returns&gt;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">bool</span> Included(T <span style="color:#66d9ef">value</span>)
        {
            Debug.Assert(<span style="color:#66d9ef">value</span> != <span style="color:#66d9ef">null</span>);

            <span style="color:#66d9ef">int</span> result;

            result = minimum.CompareTo(<span style="color:#66d9ef">value</span>);
            <span style="color:#66d9ef">if</span>((result &gt; <span style="color:#ae81ff">0</span>) || (result == <span style="color:#ae81ff">0</span> &amp;&amp; rangeIsExclusive)) {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }

            result = maximum.CompareTo(<span style="color:#66d9ef">value</span>);
            <span style="color:#66d9ef">if</span>((result &lt; <span style="color:#ae81ff">0</span>) || (result == <span style="color:#ae81ff">0</span> &amp;&amp; rangeIsExclusive)) {
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
            }

            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
        }
    }
</code></pre></div><p>Przykładowe wykorzystanie:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">            Range&lt;<span style="color:#66d9ef">double</span>&gt; discountRange = <span style="color:#66d9ef">new</span> Range&lt;<span style="color:#66d9ef">double</span>&gt;(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">99.99</span>);
            <span style="color:#66d9ef">return</span> discountRange.Included(<span style="color:#ae81ff">23</span>);
</code></pre></div><p>I to wszystko. Od teraz życia powinno stać się łatwiejsze. Przynajmniej w temacie porównywania zakresów.</p>
<p>Mała aktualizacja kilka godzin po publikacji posta:</p>
<ul>
<li>Wojtek Gębczyk zwrócił mi uwagę, iż nazwa f-cji oznacza prędzej dodanie do zbioru niż sprawdzenie bycia w danym zakresie. I miał rację. Dlatego też zmieniłem nazwę metody <code>Include</code> na <code>Included</code>. Dzięki Wojtek;</li>
<li>Michał Grzegorzewski zaproponował sprawdzanie czy podana wartość maksymalna jest większa równa od wartości minimalnej. Dodałem <code>Assert</code>. Dzięki Michał;</li>
<li>I mała dyskusja jak nazwać inaczej metodę <code>Included</code>&hellip;. Może <code>Contains</code>? Ktoś ma jakieś pomysły?</li>
</ul>

    </article>
    <nav aria-label="Related posts">
        <h4>Related Posts</h4>
        <ul>
            <li><a href="https://awasn.github.io/nie-wyrzucamy-wyjatkow-poza-domain-model/">Nie wyrzucamy wyjątków poza Domain Model</a></li>
            <li><a href="https://awasn.github.io/metoda-fabryki/">Metoda fabryki</a></li>
            <li><a href="https://awasn.github.io/konkurs-enterprise-library-logging-lab/">Konkurs Enterprise Library - Logging (LAB)</a></li>
            <li><a href="https://awasn.github.io/tworzenie-obiektow/">Tworzenie obiektów</a></li>
            <li><a href="https://awasn.github.io/herr-mock-i-frau-command/">Herr Mock i Frau Command</a></li>
        </ul>
    </nav>

    <nav class="pure-g post-previous-next" aria-label="Previous and next posts">
        <div class="pure-u-11-24 previous">
            <a href="https://awasn.github.io/marshalhelper-zarzadza-niezarzadzanym/" aria-label="Previous post"><span aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg></span></a>
            <a href="https://awasn.github.io/marshalhelper-zarzadza-niezarzadzanym/">MarshalHelper zarządza niezarządzanym</a>
        </div>
        <div class="pure-u-2-24">&nbsp;</div>
        <div class="pure-u-11-24 next">
            <a href="https://awasn.github.io/refaktoryzacja-metod-zwrotnych/">Refaktoryzacja metod zwrotnych</a>
            <a href="https://awasn.github.io/refaktoryzacja-metod-zwrotnych/" aria-label="Next post"><span aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg></span></a>
        </div>
    </nav>

    


        </main>

        <footer>
            <div class="center-aligned container">
                <p>Copyright &copy; 2007-2021 Arkadiusz Waśniewski. All Rights Reserved.</p>
            </div>
        </footer>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/accesslog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/dockerfile.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/dos.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/go.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/powershell.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/routeros.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/vbnet.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>