<!doctype html><html lang=pl-pl><head><meta name=theme-color content="#405365"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><meta name=description content="Przykład rozwiązania identyfikacji FormsAuthentication w Reporing Services"><title>FormsAuthentication w Reporing Services - arkadiusz wasniewski blog</title><link rel=canonical href=https://awasn.github.io/formsauthentication-w-reporing-services/><link rel=prev title="<![CDATA[]]> kills VS2K5" href=https://awasn.github.io/cdata-kills-vs2k5/><link rel=next title="Dynamiczna budowa poprawnego pliku docx w standardzie Open XML" href=https://awasn.github.io/dynamiczna-budowa-poprawnego-pliku-docx-w-standardzie-open-xml/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css integrity="sha256-Q0zCrUs2IfXWYx0uMKJfG93CvF6oVII21waYsAV4/8Q=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css integrity="sha256-YqnnS/cQ7vE7gfVjdfx+JMi5EFD6m6Zqdemj81rs6PU=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/agate.min.css><link rel=stylesheet href=https://awasn.github.io/awasn.min.f45a909800924faa836a73b82a1d4cb352f8053134a426a9dcafa61cf6a8c5d0.css integrity="sha256-9FqQmACST6qDanO4Kh1Ms1L4BTE0pCap3K+mHPaoxdA="></head><body><header><nav class=container><div class="pure-menu pure-menu-horizontal"><a class="pure-menu-heading pure-menu-link" href=https://awasn.github.io/>wasniewski</a><ul class="right pure-menu-list"><li class=pure-menu-item><a class=pure-menu-link href=https://awasn.github.io/blog/>blog</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://awasn.github.io/categories/>categories</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://awasn.github.io/tags/>tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://awasn.github.io/about/>about</a></li></ul></div></nav></header><main class=container><aside class=post-published><p>This post was originally published on <a href=http://zine.net.pl/blogs/arkadiusz_wasniewski/archive/2007/11/15/formsauthentication-w-reporing-services.aspx target=_blank>zine.net.pl</a> on 15 November 2007 14:41 +0200</p></aside><article><header><h1>FormsAuthentication w Reporing Services</h1><div class=post-metadata><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>15 November 2007 14:41 +0200
&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
2 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><a href=https://awasn.github.io/categories/databases>Databases</a>
&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<a href=https://awasn.github.io/tags/.net>.NET</a>, <a href=https://awasn.github.io/tags/asp.net>ASP.NET</a>, <a href=https://awasn.github.io/tags/reporting-services>Reporting Services</a>, <a href=https://awasn.github.io/tags/sql-server>SQL Server</a></div></div></header><p>Domyślnie usługi raportujące Microsoft SQL Server 2005 obsługują jedynie identyfikację Windows. Na szczęście w <a href=http://www.codeplex.com/SqlServerSamples>przykładach</a> dla Reporitng Services dostępnych na stronach <a href=http://www.codeplex.com>http://www.codeplex.com</a> dostępna jest implementacja rozszerzeń usług raportujących (interfejsy <code>IAuthenticationExtension</code> i <code>IAuthorizationExtension</code>), które umożliwiają skorzystanie z dobrodziejstw identyfikacji opartej o Forms. Jeśli zainstalujemy przykłady, to interesujące nas kody znajdziemy w katalogu <strong>C:\Program Files\Microsoft SQL Server\90\Samples\Reporting Services\Extension Samples\FormsAuthentication Sample</strong> zakładając oczywiście, iż wybraliśmy domyślną lokalizację.</p><p>Przykładowe rozwiązanie korzysta z własnej bazy danych do przechowywania informacji o użytkownikach. Zazwyczaj jednak jest tak, iż w identyfikacji Forms korzystamy z własnych danych. Wdrożenie rozszerzeń Reporting Services powoduje poważną ingerencję w strukturę i konfigurację usług raportujących serwera SQL. Zmiana bazy danych (nazewnictwo) oznacza zasadniczą modyfikację przykładowej aplikacji. A co w przyszłości? Jeśli zechcemy za jakiś czas dokonać kolejnych modyfikacji? Ciągłe zmiany w ramach Reporting Services nie są dobrym pomysłem.</p><p>Moja propozycja to zachowanie istniejącego przykładu w części weryfikującej użytkowników bez zmian. Modyfikacje natomiast wprowadzamy do skryptu tworzącego bazę danych. Usuwamy z niego kod tworzący tabelę <code>Users</code> oraz procedurę składowaną <code>RegisterUser</code> (wraz z uprawnieniami). Następnie modyfikujemy kod procedury składowanej <code>LookupUser</code>, która odpowiada za pobranie zaszyfrowanego hasła (hash) oraz wartości losowej (salt) utrudniającej złamanie hasła metodą słownikową. Zamiast sięgać do tabeli wewnątrz bazy rozszerzenia, pobierać będziemy dane z naszej własnej, zewnętrznej bazy danych. Dzięki temu wszelkie zmiany w przyszłości będą ograniczały się do niewielkiej modyfikacji kodu procedury <code>LookupUser</code> zamiast przebudowy kodu przykładowego rozszerzenia. Poniżej kod owej procedury przed modyfikacją:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> LookupUser
    <span style=color:#f92672>@</span>userName varchar(<span style=color:#ae81ff>255</span>)
<span style=color:#66d9ef>AS</span>
    <span style=color:#66d9ef>SELECT</span> PasswordHash, salt
    <span style=color:#66d9ef>FROM</span> Users
    <span style=color:#66d9ef>WHERE</span> UserName <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>userName
<span style=color:#66d9ef>GO</span>
</code></pre></div><p>oraz po niej:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> LookupUser
    <span style=color:#f92672>@</span>userName varchar(<span style=color:#ae81ff>255</span>)
<span style=color:#66d9ef>AS</span>
    <span style=color:#66d9ef>SELECT</span> u.PasswordHash, u.PasswordSalt
    <span style=color:#66d9ef>FROM</span> OurDatabase.Users <span style=color:#66d9ef>AS</span> u
    <span style=color:#66d9ef>WHERE</span> u.Name <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>userName
<span style=color:#66d9ef>GO</span>
</code></pre></div><p>PS. Dokumentacja opisująca wdrożenie rozszerzeń zawiera błąd w części dotyczącej modyfikacji pliku <strong>Web.config</strong> dla aplikacji Report Server. Jest podana niewłaściwa ścieżka dostępu do formularza logowania. Brakuje folderu <strong>Pages</strong>.</p></article><nav aria-label="Related posts"><h4>Related Posts</h4><ul><li><a href=https://awasn.github.io/sql-server-2005-compact-edition/>SQL Server 2005 Compact Edition</a></li><li><a href=https://awasn.github.io/cdata-kills-vs2k5/>&lt;![CDATA[]]> kills VS2K5</a></li><li><a href=https://awasn.github.io/visual-studio-t4-editor/>Visual Studio T4 Editor</a></li><li><a href=https://awasn.github.io/konkurs-enterprise-library-logging-lab/>Konkurs Enterprise Library - Logging (LAB)</a></li><li><a href=https://awasn.github.io/tworzenie-obiektow/>Tworzenie obiektów</a></li></ul></nav><nav class="pure-g post-previous-next" aria-label="Previous and next posts"><div class="pure-u-11-24 previous"><a href=https://awasn.github.io/cdata-kills-vs2k5/ aria-label="Previous post"><span aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"/></svg></span></a><a href=https://awasn.github.io/cdata-kills-vs2k5/>&lt;![CDATA[]]> kills VS2K5</a></div><div class=pure-u-2-24>&nbsp;</div><div class="pure-u-11-24 next"><a href=https://awasn.github.io/dynamiczna-budowa-poprawnego-pliku-docx-w-standardzie-open-xml/>Dynamiczna budowa poprawnego pliku docx w standardzie Open XML</a>
<a href=https://awasn.github.io/dynamiczna-budowa-poprawnego-pliku-docx-w-standardzie-open-xml/ aria-label="Next post"><span aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"/></svg></span></a></div></nav></main><footer><div class="center-aligned container"><p>Copyright &copy; 2007-2021 Arkadiusz Waśniewski. All Rights Reserved.</p></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/accesslog.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/dockerfile.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/dos.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/powershell.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/routeros.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/yaml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/vbnet.min.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>