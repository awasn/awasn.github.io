<!DOCTYPE HTML>
<html lang="pl-pl">
    <head>
        <meta name="theme-color" content="#405365"/>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="generator" content="Hugo 0.83.1" />
        <meta name="description" content="Skrypty przechwytujące hook scripts w .NET C# dla repozytoriów systemu kontroli wersji Subversion" />
        <title>Hook scripts w C# - arkadiusz wasniewski blog</title>
        <link rel="canonical" href="https://awasn.github.io/hook-scripts-w-csharp/">
        <link rel="prev" title="HTTP - Własny serwer komunikacji. Część #2 - Środowisko programistyczne" href="https://awasn.github.io/http-wlasny-serwer-komunikacji-cz2-srodowisko-programistyczne/">
        <link rel="next" title="tsvn:logminsize, tsvn:logtemplate" href="https://awasn.github.io/tsvn-logminsize-tsvn-logtemplate/">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css" integrity="sha256-Q0zCrUs2IfXWYx0uMKJfG93CvF6oVII21waYsAV4/8Q=" crossorigin="anonymous" />
        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css" integrity="sha256-YqnnS/cQ7vE7gfVjdfx+JMi5EFD6m6Zqdemj81rs6PU=" crossorigin="anonymous" />
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/styles/agate.min.css">
        <link rel="stylesheet" href="https://awasn.github.io/awasn.min.f45a909800924faa836a73b82a1d4cb352f8053134a426a9dcafa61cf6a8c5d0.css" integrity="sha256-9FqQmACST6qDanO4Kh1Ms1L4BTE0pCap3K&#43;mHPaoxdA=" />

    </head>
    <body>
        <header>
            <nav class="container" >
                <div class="pure-menu pure-menu-horizontal">
                    <a class="pure-menu-heading pure-menu-link" href="https://awasn.github.io/">wasniewski</a>
                    <ul class="right pure-menu-list">
                        <li class="pure-menu-item"><a class="pure-menu-link" href="https://awasn.github.io/blog/">blog</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="https://awasn.github.io/categories/">categories</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="https://awasn.github.io/tags/">tags</a></li>
                        <li class="pure-menu-item"><a class="pure-menu-link" href="https://awasn.github.io/about/">about</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <main class="container">
            
    <aside class="post-published">
        <p>This post was originally published on <a href="http://zine.net.pl/blogs/arkadiusz_wasniewski/archive/2008/02/12/hook-scripts-w-c.aspx" target="_blank">zine.net.pl</a> on 12 February 2008 16:48 &#43;0100</p>
    </aside>

    <article>
        <header>
            <h1>Hook scripts w C#</h1>
                <div class="post-metadata">
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            12 February 2008 16:48 &#43;0100
            
            &nbsp;
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            2 min read
        </div>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
            <a href="https://awasn.github.io/categories/development">Development</a>
            
                &nbsp;
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>
                <a href="https://awasn.github.io/tags/.net">.NET</a>, <a href="https://awasn.github.io/tags/subversion">Subversion</a>
            
        </div>
    </div>
        </header>

        <p>W strukturze katalogów składających się na repozytorium Subversion znajduje się folder o nazwie <strong>hooks</strong>. Zawiera on skrypty przechwytujące (<strong>hook scripts</strong>). Skrypty te wywoływane są w momencie zajścia w repozytorium określonego zdarzenia. Może to być np. żądanie zablokowania zasobu czy próba zatwierdzenia zmian. Przypisanie do zdarzenia następuje poprzez nadanie skryptowi odpowiedniej, rozpoznawalnej przez SVN nazwy. Mimo stosowania pojęcia skrypt, mogą to być tak naprawdę dowolne pliki wykonywalne. Nic nie stoi na przeszkodzie, abyśmy wykorzystali w tej roli język C#.</p>
<p>Domyślnie Subversion pozwala na zatwierdzenie zmian w repozytorium bez podania informacji (komunikatu). Najwłaściwszym miejscem do cofnięcia transakcji, która nie posiada wypełnionego logu jest zdarzenie <strong>pre-commit</strong> wywoływane przed ostatecznym zatwierdzeniem zmian. Tworzymy w związku z tym projekt typu <strong>ConsoleApplication</strong>, w którym zmieniamy wpierw nagłówek metody <code>Main</code> a następnie wypełniamy kodem:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> Main(<span style="color:#66d9ef">string</span>[] args)
    {
        <span style="color:#66d9ef">string</span> repositoryPath = args[<span style="color:#ae81ff">0</span>];
        <span style="color:#66d9ef">string</span> transactionName = args[<span style="color:#ae81ff">1</span>];

        Process process = <span style="color:#66d9ef">new</span> Process();
        process.StartInfo.FileName = <span style="color:#e6db74">&#34;svnlook.exe&#34;</span>;
        process.StartInfo.Arguments = <span style="color:#66d9ef">string</span>.Format(<span style="color:#e6db74">&#34;log -t {0} {1}&#34;</span>,
            transactionName, repositoryPath);
        process.StartInfo.UseShellExecute = <span style="color:#66d9ef">false</span>;
        process.StartInfo.RedirectStandardOutput = <span style="color:#66d9ef">true</span>;
        process.StartInfo.CreateNoWindow = <span style="color:#66d9ef">true</span>;
        process.Start();
        <span style="color:#66d9ef">string</span> output = process.StandardOutput.ReadToEnd();
        process.WaitForExit();

        Regex regex = <span style="color:#66d9ef">new</span> Regex(<span style="color:#e6db74">&#34;[a-zA-Z0-9]&#34;</span>);
        <span style="color:#66d9ef">if</span> (regex.IsMatch(output))
        {
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
        }
        <span style="color:#66d9ef">else</span>
        {
            Console.Error.WriteLine(<span style="color:#e6db74">&#34;Brak opisu poczynionych zmian.&#34;</span>);
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
        }
    }
</code></pre></div><p>Subversion dla tego zdarzenia w parametrach wywołania umieszcza informacje o ścieżce dostępu do repozytorium oraz o numerze przeprowadzanej transakcji. Wykorzystujemy te parametry do wywołania programy <strong>svnlook</strong>, który z parametrem <strong>-t</strong> przekaże nam strumień będący zawartością wpisanego przez użytkownika komunikatu. Jeśli nie ma żadnych informacji to zwracamy wartość różną od zera oraz wiadomość, którą chcemy wyświetlić zapominalskiemu użytkownikowi. Komunikat dla użytkownika musi być koniecznie przekazany na standardowe wyjście (strumień) błędów.</p>
<p>Aplikacje konsolowe są przez system uruchamiane każdorazowo w oknie. Aby tego uniknąć we właściwościach projektu, na zakładce <strong>Application</strong> zmieniamy <strong>Output type</strong> z <strong>Console Application</strong> na <strong>Windows Application</strong>.</p>

    </article>
    <nav aria-label="Posts in series">
        <h4>Posts in <a href="https://awasn.github.io/series/subversion-hook-scripts">Subversion hook scripts</a> series</h4>
        <ul>
            <li><a href="https://awasn.github.io/hook-scripts-w-csharp/">Hook scripts w C#</a></li>
            <li><a href="https://awasn.github.io/hook-scripts-w-powershell/">Hook scripts w PowerShell</a></li>
        </ul>
    </nav>
    <nav aria-label="Related posts">
        <h4>Related Posts</h4>
        <ul>
            <li><a href="https://awasn.github.io/http-wlasny-serwer-komunikacji-cz2-srodowisko-programistyczne/">HTTP - Własny serwer komunikacji. Część #2 - Środowisko programistyczne</a></li>
            <li><a href="https://awasn.github.io/http-wlasny-serwer-komunikacji-cz1-wstep/">HTTP - Własny serwer komunikacji. Część #1 - Wstęp</a></li>
            <li><a href="https://awasn.github.io/resharper-ostrzega-possible-nullreferenceexception/">ReSharper ostrzega - Possible NullReferenceException</a></li>
            <li><a href="https://awasn.github.io/metoda-fabryki/">Metoda fabryki</a></li>
            <li><a href="https://awasn.github.io/dynamiczna-budowa-poprawnego-pliku-docx-w-standardzie-open-xml/">Dynamiczna budowa poprawnego pliku docx w standardzie Open XML</a></li>
        </ul>
    </nav>

    <nav class="pure-g post-previous-next" aria-label="Previous and next posts">
        <div class="pure-u-11-24 previous">
            <a href="https://awasn.github.io/http-wlasny-serwer-komunikacji-cz2-srodowisko-programistyczne/" aria-label="Previous post"><span aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg></span></a>
            <a href="https://awasn.github.io/http-wlasny-serwer-komunikacji-cz2-srodowisko-programistyczne/">HTTP - Własny serwer komunikacji. Część #2 - Środowisko programistyczne</a>
        </div>
        <div class="pure-u-2-24">&nbsp;</div>
        <div class="pure-u-11-24 next">
            <a href="https://awasn.github.io/tsvn-logminsize-tsvn-logtemplate/">tsvn:logminsize, tsvn:logtemplate</a>
            <a href="https://awasn.github.io/tsvn-logminsize-tsvn-logtemplate/" aria-label="Next post"><span aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg></span></a>
        </div>
    </nav>

    


        </main>

        <footer>
            <div class="center-aligned container">
                <p>Copyright &copy; 2007-2021 Arkadiusz Waśniewski. All Rights Reserved.</p>
            </div>
        </footer>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/accesslog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/dockerfile.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/dos.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/go.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/powershell.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/routeros.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/languages/vbnet.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>